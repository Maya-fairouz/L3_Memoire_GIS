{% extends 'base.html' %}

{% load static %}

{% block content %}
<h3 class="page-title">
  <span class="page-title-icon bg-gradient-primary text-white me-2">
    <i class="mdi mdi-content-paste"></i>
  </span> View Obstacle 
</h3>
<nav aria-label="breadcrumb">
  <ul class="breadcrumb">
    <li class="breadcrumb-item active" aria-current="page">
      <span></span>Overview <i class="mdi mdi-alert-circle-outline icon-sm text-primary align-middle"></i>
    </li>
  </ul>
</nav>
</div>

<form action="/view-obstacles/{{obstacle.id}}" method="POST" enctype="multipart/form-data" class="forms-sample">
  {% csrf_token %}
  
  <div class="form-group">
    <label>Location</label>
    <input type="text" value="{{obstacle.location}}" id="location" class="form-control" name="location" readonly>
    <br>
    <div id="map" style="height: 250px; width: 250px;"></div>
  </div>


  <div class="form-group">
    <label>File Upload</label>
    <div class="custom-file">
      <input type="text" class="form-control file-upload-info" disabled placeholder="File uploaded">
       <br>      
      <img style= "height:300px; width:300px"src="{{obstacle.image.url}}"></img>

    </div>
  </div>
  <div class="form-group">
    <label for="exampleTextarea1">Description</label>
    <textarea class="form-control" id="exampleTextarea1" name="description" rows="4" readonly>{{obstacle.description}}</textarea>
  </div> 

  <div class="form-group">
    <label for="reported-by">Reported By</label>
    <input type="text" value ="{{obstacle.reported_by}}"id="reported-by" class="form-control" name="reported_by" value="{{ user.username }}" readonly>
  </div>

  <div class="form-group">
    <label for="status">Status</label>
    <select class="form-control" id="status" name="status">
      <option value="Pending">{{obstacle.status}}</option>
      <option value="Fixed">Fixed</option>
  
    </select>
  </div>

  {{form.errors}}

  <button type="submit" class="btn btn-gradient-primary me-2">OK</button>
  <button class="btn btn-light">Cancel</button>
</form>
  <script>

    let map =L.map('map').setView([36.3071,6.5963] , 12);
    
    var alertIcon = L.icon({
        
      iconUrl: 'static/redX.png',
      iconSize:  [35, 35], // size of the icon
      className: 'aaaaaaa'
  
    })
  
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    console.log({{obstacle.location}})
    marker = L.marker([{{obstacle.location}}]).addTo(map);
    $(document).on('submit', 'form', function(e) {
      e.preventDefault();
    
      // Retrieve the form field values
      var location = document.getElementById('location').value;
      var description = document.getElementById('exampleTextarea1').value;
    
      // Perform any additional processing or validation here
    
      // Submit the form data via AJAX or regular form submission
      $.ajax({
        type: 'POST',
        url: $(this).attr('action'),
        data: {
          location: location,
          description: description,
          csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
          // Handle the success response
        },
        error: function(response) {
          // Handle the error response
        }
      });
    });
  </script>
{% endblock %}
